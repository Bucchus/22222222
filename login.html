<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="stylesheet" href="css/iconfont.css">
	<link rel="stylesheet" href="css/global.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="css/login.css">
	<script src="js/jquery.1.12.4.min.js" charset="UTF-8"></script>
	<script src="js/bootstrap.min.js" charset="UTF-8"></script>
	<script src="js/jquery.form.js" charset="UTF-8"></script>
	<script src="js/global.js" charset="UTF-8"></script>
	<script src="js/login.js" charset="UTF-8"></script>
	<title>商城网 - 登录 / 注册</title>
	<script src="js/jquery.params.js"></script>
</head>
<body>
	<div class="public-head-layout container">
		<a class="logo" href="index.html"><img src="images/icons/logo.jpg" alt="商城网" class="cover"></a>
	</div>
	<div style="background:url(images/login_bg.jpg) no-repeat center center; ">
		<div class="login-layout container">
			<div class="form-box login">
				<div class="tabs-nav">
					<h2>欢迎登录商城网平台</h2>
				</div>
				<div class="tabs_container">
					<form class="tabs_form" action="" method="post" id="login_form">
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-phone" aria-hidden="true"></span>
								</div>
								<input class="form-control phone keylog" name="phone" id="login_phone" required placeholder="手机号" maxlength="11" autocomplete="off" type="text">
							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
								</div>
								<input class="form-control password keylog" name="password" id="login_pwd" placeholder="请输入密码" autocomplete="off" type="password">
								<div class="input-group-addon pwd-toggle" title="显示密码"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></div>
							</div>
						</div>
						<div class="checkbox">
	                        <label>
	                        	<input checked="" id="login_checkbox" type="checkbox"><i></i> 30天内免登录
	                        </label>
	                        <a href="javascript:;" class="pull-right" id="resetpwd">忘记密码？</a>
	                    </div>
	                    <!-- 错误信息 -->
						<div class="form-group">
							<div class="error_msg" id="login_error">
								<!-- 错误信息 范例html
								<div class="alert alert-warning alert-dismissible fade in" role="alert">
									<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
									<strong>密码错误</strong> 请重新输入密码
								</div>
								 -->
							</div>
						</div>
	                    <button class="btn btn-large btn-primary btn-lg btn-block submit" id="login_submit" type="button">登录</button><br>
	                    <p class="text-center">没有账号？<a href="javascript:;" id="register">免费注册</a></p>
                    </form>
                    <div class="tabs_div">
	                    <div class="success-box">
	                    	<div class="success-msg">
								<i class="success-icon"></i>
	                    		<p class="success-text">登录成功</p>
	                    	</div>
	                    </div>
	                    <div class="option-box">
	                    	<div class="buts-title">
	                    		现在您可以
	                    	</div>
	                    	<div class="buts-box">
	                    		<a role="button" href="index.html" class="btn btn-block btn-lg btn-default">继续访问商城</a>
								<a role="button" href="udai_welcome.html" class="btn btn-block btn-lg btn-info">登录会员中心</a>
	                    	</div>
	                    </div>
                    </div>
                </div>
			</div>
			<div class="form-box register">
  				<div class="tabs-nav">
  					<h2>欢迎注册<a href="javascript:;" class="pull-right fz16" id="reglogin">返回登录</a></h2>
  				</div>
  				<div class="tabs_container">
					<form class="tabs_form" action="index.html" method="post" id="register_form">
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-phone" aria-hidden="true"></span>
								</div>
								<input class="form-control phone keyreg" name="phone" id="register_phone"   required placeholder="手机号" maxlength="11" autocomplete="off" type="text"/>

							</div>
							<span id="aaa" style="color: #b31e22"></span>
						</div>
					<!--	<div class="form-group">
							<div class="input-group">
								<input class="form-control" name="smscode" id="register_sms" placeholder="输入验证码" type="text">
								<span class="input-group-btn">
									<button class="btn btn-primary getsms" type="button">发送短信验证码</button>
								</span>
							</div>
						</div>-->
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
								</div>
								<input class="form-control password keyreg" name="password" id="register_pwd" placeholder="请输入密码" autocomplete="off" type="password">
								<div class="input-group-addon pwd-toggle" title="显示密码"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></div>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
								</div>
								<input class="form-control password password" name="password02" id="register_pwd02" placeholder="请输入密码" autocomplete="off" type="password">
								<div class="input-group-addon pwd-toggle" title="显示密码"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></div>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
								</div>
								<input class="form-control password yqm keyreg" name="yqm" id="register_yqm" placeholder="请输入邀请码" autocomplete="off" type="text">

							</div>
						</div>
						<div class="checkbox">
	                        <label>
	                        	<input checked="" id="register_checkbox" type="checkbox"><i></i> 同意<a href="temp_article/udai_article3.html">商城网用户协议</a>
	                        </label>
	                    </div>
	                    <!-- 错误信息 -->
						<div class="form-group">
							<div class="error_msg" id="register_error"></div>
						</div>
	                    <button class="btn btn-large btn-primary btn-lg btn-block submit" id="register_submit" type="button">注册</button>
                    </form>
                    <div class="tabs_div" id="rege">
	                    <div class="success-box">
	                    	<div class="success-msg">
								<i class="success-icon"></i>
	                    		<p class="success-text">注册成功</p>
	                    	</div>
	                    </div>
	                    <div class="option-box">
	                    	<div class="buts-title">
	                    		现在您可以
	                    	</div>
	                    	<div class="buts-box">
	                    		<a role="button" href="index.html" class="btn btn-block btn-lg btn-default">继续访问商城</a>
								<a role="button" href="udai_welcome.html" class="btn btn-block btn-lg btn-info">登录会员中心</a>
	                    	</div>
	                    </div>
                    </div>
                </div>
			</div>
			<div class="form-box resetpwd">
  				<div class="tabs-nav clearfix">
  					<h2>找回密码<a href="javascript:;" class="pull-right fz16" id="pwdlogin">返回登录</a></h2>
  				</div>
  				<div class="tabs_container">
					<form class="tabs_form" action="https://rpg.blue/member.php?mod=logging&action=login" method="post" id="resetpwd_form">
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-phone" aria-hidden="true"></span>
								</div>
								<input class="form-control phone" name="phone" id="resetpwd_phone" required placeholder="手机号" maxlength="11" autocomplete="off" type="text">
							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<input class="form-control" name="sms" id="resetpwd_sms" placeholder="输入验证码" type="text">
								<span class="input-group-btn">
									<button class="btn btn-primary getsms" type="button">发送短信验证码</button>
								</span>
							</div>
						</div>
						<div class="form-group">
							<div class="input-group">
								<div class="input-group-addon">
									<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
								</div>
								<input class="form-control password" name="password" id="resetpwd_pwd" placeholder="新的密码" autocomplete="off" type="password">
								<div class="input-group-addon pwd-toggle" title="显示密码"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></div>
							</div>
						</div>
	                    <!-- 错误信息 -->
						<div class="form-group">
							<div class="error_msg" id="resetpwd_error"></div>
						</div>
	                    <button class="btn btn-large btn-primary btn-lg btn-block submit" id="resetpwd_submit" type="button">重置密码</button>
                    </form>
                    <div class="tabs_div">
	                    <div class="success-box">
	                    	<div class="success-msg">
								<i class="success-icon"></i>
	                    		<p class="success-text">密码重置成功</p>
	                    	</div>
	                    </div>
	                    <div class="option-box">
	                    	<div class="buts-title">
	                    		现在您可以
	                    	</div>
	                    	<div class="buts-box">
	                    		<a role="button" href="index.html" class="btn btn-block btn-lg btn-default">继续访问商城</a>
								<a role="button" href="login.html" class="btn btn-block btn-lg btn-info">返回登陆</a>
	                    	</div>
	                    </div>
                    </div>
                </div>
			</div>
			<script>
				$(document).ready(function() {
					// 判断直接进入哪个页面 例如 login.php?p=register
					switch($.getUrlParam('p')) {
						case 'register': $('.register').show(); break;
						case 'resetpwd': $('.resetpwd').show(); break;
						default: $('.login').show();
					};
					// 发送验证码事件
					$('.getsms').click(function() {
						var phone = $(this).parents('form').find('input.phone');
						var error = $(this).parents('form').find('.error_msg');
						switch(phone.validatemobile()) {
							case 0:
								// 短信验证码的php请求
								error.html(msgtemp('验证码 <strong>已发送</strong>','alert-success'));
								$(this).rewire(60);
							break;
							case 1: error.html(msgtemp('<strong>手机号码为空</strong> 请输入手机号码',    'alert-warning')); break;
							case 2: error.html(msgtemp('<strong>手机号码错误</strong> 请输入11位数的号码','alert-warning')); break;
							case 3: error.html(msgtemp('<strong>手机号码错误</strong> 请输入正确的号码',  'alert-warning')); break;
						}
					});


                    var xmlHttp;
                    var flag;
                    function createXMLHttp()
                    {

                        if(window.XMLHttpRequest){
                            //火狐浏览器
                            xmlHttp = new XMLHttpRequest();
                        }else{
                            //IE浏览器
                            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                            alert(xmlHttp);
                        }

                    }
                    function checkXMLHttp()
                    {
                        if(window.XMLHttpRrequest){
                            xmlHttp = new XMLHttpRrequest();
                        }else{
                            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                        }
                    }
                    function checkUserid(username)
                    {
                        createXMLHttp();
                        xmlHttp.open("POST","http://192.168.18.117:9001/Shop/front/MemberServlet?status=regist&username="+username);
                        xmlHttp.onreadystatechange = checkUseridCallback;
                        xmlHttp.send(null);
                        document.getElementById("aaa").innerHTML = "";
                        document.getElementById('register_submit').removeAttribute("disabled", "disabled")
                    }
                    function checkUseridCallback()
                    {
                        if(xmlHttp.readyState == 4){
                            if(xmlHttp.status == 200){
                                var text = xmlHttp.responseText;
                                if(text=="true"){
                                    flag = false;
                                    document.getElementById("aaa").innerHTML="此用户id已经存在，无法注册";
                                    document.getElementById('register_submit').setAttribute("disabled", "disabled")
                                }else{
                                    flag = true;
                                    document.getElementById("aaa").innerHTML="";
                                    document.getElementById('register_submit').removeAttribute("disabled", "disabled")
                                }
                            }
                        }
                    }


					$("#register_phone").blur(function () {
                        checkUserid($(this).val())
                    })

                    $(".keylog").keyup(function(event){
                        if(event.keyCode ==13){
                            $("#login_submit").trigger("click");
                        }
                    });
                    $(".keyreg").keyup(function(event){
                        if(event.keyCode ==13){
                            $("#register_submit").trigger("click");
                        }
                    });



					// 以下确定按钮仅供参考
					$('#register_submit').click(function() {
						var form = $(this).parents('form')
						var phone = form.find('input.phone');
						var testphone = form.find('input.phone').val();
						var pwd = form.find('input.password');
						var pwd02 = form.find('input.password02');
						var yqm = form.find('input.yqm');
						var ck = form.find('#register_checkbox');
						var error = form.find('.error_msg');
						var success = form.siblings('.tabs_div');
						var options = {
							beforeSubmit: function () {
								console.log('喵喵喵')
							},
							success: function (data) {
								console.log(data);
							}
						}


						// 验证手机号
						switch(phone.validatemobile()) {
							case 1: error.html(msgtemp('<strong>手机号码为空</strong> 请输入手机号码',    'alert-warning')); return; break;
							case 2: error.html(msgtemp('<strong>手机号码错误</strong> 请输入11位数的号码','alert-warning')); return; break;
							case 3: error.html(msgtemp('<strong>手机号码错误</strong> 请输入正确的号码',  'alert-warning')); return; break;
						}
						// 验证密码复杂度
						switch(pwd.validatepwd()) {
							case 1: error.html(msgtemp('<strong>密码不能为空</strong> 请输入密码',    'alert-warning')); return; break;
							case 2: error.html(msgtemp('<strong>密码过短</strong> 请输入6位以上的密码','alert-warning')); return; break;
							case 3: error.html(msgtemp('<strong>密码过于简单</strong><br>密码需为字母、数字或特殊字符组合',  'alert-warning')); return; break;
						}
                        // 验证密码是否一致
                        switch(pwd02.validatepwd02()) {
                            case 1: error.html(msgtemp('<strong>密码不一致</strong> 请重新输入',    'alert-warning')); return; break;

                        }

                        // 验证邀请码
                        switch(yqm.validateinvi()) {
                            case 1: error.html(msgtemp('<strong>邀请码不可为空</strong> 请重新输入',    'alert-warning')); return; break;

                        }

                        // 验证是否选中同意条款
                        switch(ck.validateck()) {
                            case 1: error.html(msgtemp('<strong>请先同意</strong> 服务条款',    'alert-warning')); return; break;

                        }
                        var testphone = $("#register_phone").val();
                        var pwd = $("#register_pwd").val();
                        var yqm = $("#register_yqm").val();

                        $.ajax({
                            url:'http://192.168.18.132:8080/Shop/MobileMemberServlet?status=reg',
                            dataType:'json',
                            data:{"phone":testphone,"pwd1":pwd,"invitePerson":yqm},
                            type:'post',
                            success:function(result){

                                console.log(result.msg);
                                if(result.message=="该手机号已经注册"){
                                    $("#plphone .msg-box .err-tips02").css('display','block');
                                }else{
                                    $("#rege").css('display','block');
                                    $("#register_form").css('display','none')
                                }
                            }


                        })

                        console.log(232323);

						form.ajaxForm(options);
						// 请求成功执行类似这样的事件
						// form.fadeOut(150,function() {
						// 	success.fadeIn(150);
						// });
					});
                    $('#login_submit').click(function() {
                        var form = $(this).parents('form')
                        var phone = form.find('input.phone');
                        var pwd = form.find('input.password');

                        var error = form.find('.error_msg');
                        var success = form.siblings('.tabs_div');
                        var options = {
                            beforeSubmit: function () {
                                console.log('喵喵喵')
                            },
                            success: function (data) {
                                console.log(data);
                            }
                        }


                        // 验证手机号参考这个
                        switch(phone.validatemobile()) {
                            case 1: error.html(msgtemp('<strong>手机号码为空</strong> 请输入手机号码',    'alert-warning')); return; break;
                            case 2: error.html(msgtemp('<strong>手机号码错误</strong> 请输入11位数的号码','alert-warning')); return; break;
                            case 3: error.html(msgtemp('<strong>手机号码错误</strong> 请输入正确的号码',  'alert-warning')); return; break;
                        }
                        // 验证密码复杂度参考这个
                        switch(pwd.validatepwd()) {
                            case 1: error.html(msgtemp('<strong>密码不能为空</strong> 请输入密码',    'alert-warning')); return; break;
                            case 2: error.html(msgtemp('<strong>密码过短</strong> 请输入6位以上的密码','alert-warning')); return; break;
                            case 3: error.html(msgtemp('<strong>密码过于简单</strong><br>密码需为字母、数字或特殊字符组合',  'alert-warning')); return; break;
                        }
						console.log(5656);
                        var loginName = $("#login_phone").val();
                        var loginPwd = $("#login_pwd").val();
                        //可能有验证码  captchadata captchakey 等数据，这里省略，只关注重点部分
                        /*loginName = encrypt(loginName);
                        loginPwd = encrypt(loginPwd);*/

                        $.ajax({
                            url:'http://192.168.18.132:8080/Shop/MobileFrontLoginServlet',
                            dataType:'json',
                            data:{"username":loginName,"password":loginPwd},
                            type:'post',
                            success:function(result){
                                console.log(result.errors);
                                if(result.errors){
                                    alert(result.errors)
								}else{
                                    alert(result.uname);
                                    name = result.uname;
                                    photoh =  result.photoFront;





                                    localStorage.setItem("name",name);
                                    localStorage.setItem("photoh",photoh);

                                    window.location.href = "index.html";
								}







                            }


                        })



                        form.ajaxForm(options);
                        // 请求成功执行类似这样的事件
                        // form.fadeOut(150,function() {
                        // 	success.fadeIn(150);
                        // });
                    });
					//login_submit



				});
			</script>
		</div>
	</div>
	<div class="footer-login container clearfix">
		<ul class="links">
			<a href=""><li>网店代销</li></a>
			<a href=""><li>商城学堂</li></a>
			<a href=""><li>联系我们</li></a>
			<a href=""><li>企业简介</li></a>
			<a href=""><li>新手上路</li></a>
		</ul>
		<!-- 版权 -->
		<p class="copyright">
			© 2005-2017 商城网 版权所有，并保留所有权利<br>
			ICP备案证书号：8888888&nbsp;&nbsp;&nbsp;&nbsp;8888888&nbsp;&nbsp;&nbsp;&nbsp;Tel: 188888888&nbsp;&nbsp;&nbsp;&nbsp;E-mail: 18888888@qq.com
		</p>
	</div>
</body>
</html>